<!DOCTYPE html>
<html lang="">
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width,initial-scale=1.0" />
        <link rel="icon" href="<%= BASE_URL %>favicon.ico" />
        <script src="https://map.qq.com/api/gljs?v=1.exp&key=UFVBZ-2X7KX-JJI4O-Z25B4-CCRV3-BIBME&libraries=tools"></script>
        <script
            crossorigin="anonymous"
            integrity="sha512-UNM1njAgOFUa74Z0bADwAq8gbTcqZC8Ej4xPSzpnh0l6KMevwvkBvbldF9uR++qKeJ+MOZHRjV1HZjoRvjDfNQ=="
            src="https://lib.baomitu.com/uuid/8.3.2/uuid.min.js"
        ></script>
        <title>mapEditor</title>
    </head>
    <body>
        <div class="left">
            <div id="map"></div>
        </div>
        <div class="right">
            <button onclick="overrideimport()">覆盖</button>
            <textarea name="" id="ptxt" cols="30" rows="10"></textarea>
        </div>
    </body>
    <style>
        .left {
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 300px;
        }
        .right {
            position: absolute;
            top: 0;
            bottom: 0;
            right: 0;
            width: 300px;
        }
        textarea {
            display: block;
            width: 99%;
            height: 90%;
        }
        #map {
            width: 100%;
            height: 100%;
        }
    </style>
    <script>
        const points = []
        window.map = new TMap.Map(document.getElementById('map'), {
            center: new TMap.LatLng(40.15756173403039, 116.2895435631267), //设置地图中心点坐标
            zoom: 17.2, //设置地图缩放级别
            pitch: 43.5, //设置俯仰角
            rotation: 0, //设置地图旋转角度
        })
        var markerLayer = new TMap.MultiMarker({
            id: 'marker-layer',
            map: map,
            geometries: JSON.parse(localStorage.mapEditPoints || '[]'),
        })
        document.getElementById('ptxt').value = localStorage.mapEditPoints || '[]'
        markerLayer.on('click', (ev) => {
            if (confirm('删除？')) markerLayer.remove(ev.geometry.id)
            localStorage.mapEditPoints = JSON.stringify(markerLayer.geometries, null, 4)
            document.getElementById('ptxt').value = localStorage.mapEditPoints || '[]'
        })

        //监听点击事件添加marker
        map.on('rightclick', (evt) => {
            if (!(n = prompt('name'))) return
            const p = {
                id: uuid.v4(),
                name: n,
                position: evt.latLng,
                neighborWalk: [],
                neighborBike: [],
            }
            markerLayer.add(p)
            localStorage.mapEditPoints = JSON.stringify(markerLayer.geometries, null, 4)
            document.getElementById('ptxt').value = localStorage.mapEditPoints || '[]'
            return false;
        })
        function overrideimport(){
            localStorage.mapEditPoints = document.getElementById('ptxt').value
            location.reload()
        }
    </script>
</html>
